<!-- 商品情報 -->
<div class="item-info">
  <div class="item-info__titel">
  <h1><%= @item.name %></h1>
  <div>
    <h3>平均<%= @average %>点
      <span id="star-rate-item-<%= @item.id %>"></span>
    </h3>
    <% @personals.each do |personal| %>
      <%= link_to personal_path(personal) do %>
        <%= personal.name %>
          <%= "(#{Review.joins(user: :personal_users).where(user: { personal_users: { personal: personal } }).count})" %>
      <% end %>
    <% end %>
    <script>
    $('#star-rate-item-<%= @item.id %>').empty();
     $('#star-rate-item-<%= @item.id %>').raty({
        size: 36,
          starOff:  '<%= asset_path('star-off.png') %>',
          starOn : '<%= asset_path('star-on.png') %>',
          starHalf: '<%= asset_path('star-half.png') %>',
        half: true,
        readOnly: true,
        score: <%= @item.reviews.average(:rate).to_f.round(1) %>
      });
    </script>
  </div>
  </div>
  <!-- 代表投稿（いいね1番多い投稿） -->
  <div class="item-info__top-review">
      <div class="d-flex">
        <div class="my-box">
          <div class="item-info__top-review__image">
          <% @item_ranks.first(1).each do |review| %>
            <% review.review_images.first(1).each do |image| %>
              <%= link_to attachment_image_tag(image, :image, format: 'jpeg', fallback: "sample.png", class: "reviewimage"), review_path(review) %>
            <% end %>
            </div>
        </div>
        <div class="my-box align-self-center">
          <div>
           <%= link_to user_path(review) do %>
            <%= attachment_image_tag review.user, :profile_image, :fill, 70, 70, format: 'jpeg', fallback: "sample.png", class: "rounded-circle" %>
            <span class="h4"><%= review.user.name %></span>
          <% end %>
          </div>
          <div class="item-info__top-review__body">
          <p><%= review.body %></p>
            <% review.tags.each do |tag| %>
              <p><%= link_to "#" + tag.tag_name, tag_path(tag) %></p>
            <% end %>
          </div>
            <span id="like-<%= review.id %>">
              <%= render partial: "likes/like", locals: { review: review } %>
            </span>
            <i class="fas fa-comment"></i><%= review.comments.count %>
          <% end %>
      </div>
    </div>
  </div>
  <div class="item-info__reviews">
  <h3><%= "全#{@item.reviews.count}件" %></h3>
  <div class="item-info__reviews__item">
    <%= render "reviews/review", reviews: @reviews %>
  </div>
</div>
</div>

